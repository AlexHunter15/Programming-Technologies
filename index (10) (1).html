<script>
    // Model
    class PropertyModel {
        constructor() {
            this.key = 'properties';
            this.properties = [];
            this.load();
        }

        load() {
            const data = localStorage.getItem(this.key);
            this.properties = data ? JSON.parse(data) : [];
        }

        save() {
            localStorage.setItem(this.key, JSON.stringify(this.properties));
        }

         restore() {
            const storedData = localStorage.getItem(this.key);
            if (storedData) {
                this.data = JSON.parse(storedData);
            } else {
                // Начальный набор данных, если localStorage пуст
                this.data = [
                     { id: '1', description: 'Описание объекта 1', createdAt: new Date('2024-01-01'), author: 'Иван Иванов', photoLink: 'https://example.com/photo1.jpg' },
  { id: '2', description: 'Описание объекта 2', createdAt: new Date('2024-01-02'), author: 'Петр Петров', photoLink: 'https://example.com/photo2.jpg' },
  { id: '3', description: 'Описание объекта 3', createdAt: new Date('2024-01-03'), author: 'Анна Смирнова' },
  { id: '4', description: 'Описание объекта 4', createdAt: new Date('2024-01-04'), author: 'Иван Иванов' },
  { id: '5', description: 'Описание объекта 5', createdAt: new Date('2024-01-05'), author: 'Мария Сидорова', photoLink: 'https://example.com/photo5.jpg' },
  { id: '6', description: 'Описание объекта 6', createdAt: new Date('2024-01-06'), author: 'Дмитрий Васильев' },
  { id: '7', description: 'Описание объекта 7', createdAt: new Date('2024-01-07'), author: 'Сергей Кузнецов' },
  { id: '8', description: 'Описание объекта 8', createdAt: new Date('2024-01-08'), author: 'Анна Смирнова' },
  { id: '9', description: 'Описание объекта 9', createdAt: new Date('2024-01-09'), author: 'Иван Иванов' },
  { id: '10', description: 'Описание объекта 10', createdAt: new Date('2024-01-10'), author: 'Ольга Николаева', photoLink: 'https://example.com/photo10.jpg' },
  { id: '11', description: 'Описание объекта 11', createdAt: new Date('2024-01-11'), author: 'Мария Сидорова' },
  { id: '12', description: 'Описание объекта 12', createdAt: new Date('2024-01-12'), author: 'Сергей Кузнецов' },
  { id: '13', description: 'Описание объекта 13', createdAt: new Date('2024-01-13'), author: 'Дмитрий Васильев' },
  { id: '14', description: 'Описание объекта 14', createdAt: new Date('2024-01-14'), author: 'Анна Смирнова' },
  { id: '15', description: 'Описание объекта 15', createdAt: new Date('2024-01-15'), author: 'Иван Иванов' },
  { id: '16', description: 'Описание объекта 16', createdAt: new Date('2024-01-16'), author: 'Ольга Николаева' },
  { id: '17', description: 'Описание объекта 17', createdAt: new Date('2024-01-17'), author: 'Сергей Кузнецов' },
  { id: '18', description: 'Описание объекта 18', createdAt: new Date('2024-01-18'), author: 'Дмитрий Васильев', photoLink: 'https://example.com/photo18.jpg' },
  { id: '19', description: 'Описание объекта 19', createdAt: new Date('2024-01-19'), author: 'Мария Сидорова' },
  { id: '20', description: 'Описание объекта 20', createdAt: new Date('2024-01-20'), author: 'Иван Иванов', photoLink: 'https://example.com/photo20.jpg' },
                ];
                this.save();
            }
         }
        getNextId() {
            return this.properties.length ? Math.max(...this.properties.map(p => p.id)) + 1 : 1;
        }

        add(property) {
            this.properties.push(property);
            this.save();
        }

        update(id, updates) {
            const prop = this.properties.find(p => p.id === id);
            if (prop) {
                Object.assign(prop, updates);
                this.save();
                return true;
            }
            return false;
        }

        delete(id) {
            const index = this.properties.findIndex(p => p.id === id);
            if (index !== -1) {
                this.properties.splice(index, 1);
                this.save();
                return true;
            }
            return false;
        }

        search(query) {
            const term = query.toLowerCase();
            return this.properties.filter(p =>
                p.title.toLowerCase().includes(term) ||
                p.location.toLowerCase().includes(term) ||
                p.area.toString().includes(term)
            );
        }
    }

    // View
    class PropertyView {
        static toggleSection(sectionId) {
            document.querySelectorAll('main > section').forEach(section => {
                section.style.display = section.id === sectionId ? 'block' : 'none';
            });
        }

        static renderSearchResults(results) {
            const container = document.getElementById('search-results');
            container.innerHTML = results.length
                ? results.map(r => `
                    <p>
                        <strong>ID:</strong> ${r.id}, 
                        <strong>Название:</strong> ${r.title}, 
                        <strong>Местоположение:</strong> ${r.location}, 
                        <strong>Площадь:</strong> ${r.area} м²
                    </p>`).join('')
                : '<p>Результатов не найдено.</p>';
        }

        static resetForm(formId) {
            document.getElementById(formId).reset();
        }

        static showMessage(message) {
            alert(message);
        }
    }

    // Controller
    class PropertyController {
        constructor() {
            this.model = new PropertyModel();
            this.init();
        }

        init() {
            this.bindNavigation();
            this.bindAddForm();
            this.bindEditForm();
            this.bindDeleteForm();
            this.bindSearchForm();
        }

        bindNavigation() {
            const navLinks = document.querySelectorAll('header nav ul li a');
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const target = link.getAttribute('href').substring(1);
                    PropertyView.toggleSection(target);
                });
            });
        }

        bindAddForm() {
            document.getElementById('add-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const title = document.getElementById('title').value;
                const location = document.getElementById('location').value;
                const area = parseInt(document.getElementById('area').value);

                this.model.add({ id: this.model.getNextId(), title, location, area });
                PropertyView.showMessage('Помещение добавлено успешно!');
                PropertyView.resetForm('add-form');
            });
        }

        bindEditForm() {
            document.getElementById('edit-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const id = parseInt(document.getElementById('edit-id').value);
                const updates = {
                    title: document.getElementById('new-title').value || undefined,
                    location: document.getElementById('new-location').value || undefined,
                    area: parseInt(document.getElementById('new-area').value) || undefined,
                };

                if (this.model.update(id, updates)) {
                    PropertyView.showMessage('Информация обновлена успешно!');
                    PropertyView.resetForm('edit-form');
                } else {
                    PropertyView.showMessage('Помещение с таким ID не найдено!');
                }
            });
        }

        bindDeleteForm() {
            document.getElementById('delete-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const id = parseInt(document.getElementById('delete-id').value);

                if (this.model.delete(id)) {
                    PropertyView.showMessage('Помещение удалено успешно!');
                    PropertyView.resetForm('delete-form');
                } else {
                    PropertyView.showMessage('Помещение с таким ID не найдено!');
                }
            });
        }

        bindSearchForm() {
            document.getElementById('search-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const query = document.getElementById('search-query').value;
                const results = this.model.search(query);
                PropertyView.renderSearchResults(results);
            });
        }
    }

    // Инициализация контроллера при загрузке страницы
    document.addEventListener('DOMContentLoaded', () => {
        new PropertyController();
    });
</script>
