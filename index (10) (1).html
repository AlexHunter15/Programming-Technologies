<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Управление объектами недвижимости</title>
    <style>
        /* Сброс стилей */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: Arial, sans-serif;
    line-height: 1.6;
    color: #333;
}

header, footer {
    background-color: #333;
    color: #fff;
    padding: 10px;
    text-align: center;
}

header h1, footer p {
    margin: 0;
}

nav ul {
    list-style: none;
    padding: 0;
}

nav ul li {
    display: inline;
    margin-right: 10px;
}

nav ul li a {
    color: #fff;
    text-decoration: none;
}

main {
    padding: 20px;
}

h2 {
    color: #5a67d8;
    margin-bottom: 10px;
}

form label {
    display: block;
    margin-bottom: 5px;
}

form input, form select {
    width: 100%;
    padding: 8px;
    margin-bottom: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

form button {
    background-color: #5a67d8;
    color: #fff;
    border: none;
    padding: 10px;
    cursor: pointer;
    border-radius: 4px;
}

form button:hover {
    background-color: #4c51bf;
}

.hint {
    font-size: 0.9em;
    color: #666;
}

footer p {
    font-size: 0.9em;
}
    </style>
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="#search-section">Поиск объектов</a></li>
                <li><a href="#add-section">Добавить объект</a></li>
                <li><a href="#edit-section">Редактировать объект</a></li>
                <li><a href="#delete-section">Удалить объект</a></li>
            </ul>
        </nav>
    </header>

    <!-- Форма входа -->
    <div id="login-form" style="display:none;">
        <form id="login-form">
            <label for="username">Логин:</label>
            <input type="text" id="username" name="username" required><br>
            <label for="password">Пароль:</label>
            <input type="password" id="password" name="password" required><br>
            <button type="submit">Войти</button>
        </form>
    </div>

    <!-- Разделы для работы с объектами -->
    <main>
        <!-- Раздел поиска -->
        <section id="search-section">
            <h2>Поиск объектов</h2>
            <form id="search-form">
                <input type="text" id="search-query" placeholder="Поиск по описанию или автору">
                <button type="submit">Поиск</button>
            </form>
            <div id="search-results"></div>
        </section>

        <!-- Раздел добавления -->
        <section id="add-section">
            <h2>Добавить объект</h2>
            <form id="add-form">
                <label for="description">Описание:</label>
                <input type="text" id="description" name="description" required><br>
                <label for="author">Автор:</label>
                <input type="text" id="author" name="author" required><br>
                <label for="photoLink">Фото (по желанию):</label>
                <input type="text" id="photoLink" name="photoLink"><br>
                <button type="submit">Добавить объект</button>
            </form>
        </section>

        <!-- Раздел редактирования -->
        <section id="edit-section">
            <h2>Редактировать объект</h2>
            <form id="edit-form">
                <label for="edit-id">ID объекта:</label>
                <input type="number" id="edit-id" name="edit-id" required><br>
                <label for="new-description">Новое описание:</label>
                <input type="text" id="new-description" name="new-description"><br>
                <label for="new-author">Новый автор:</label>
                <input type="text" id="new-author" name="new-author"><br>
                <label for="new-photoLink">Новая ссылка на фото:</label>
                <input type="text" id="new-photoLink" name="new-photoLink"><br>
                <button type="submit">Обновить объект</button>
            </form>
        </section>

        <!-- Раздел удаления -->
        <section id="delete-section">
            <h2>Удалить объект</h2>
            <form id="delete-form">
                <label for="delete-id">ID объекта для удаления:</label>
                <input type="number" id="delete-id" name="delete-id" required><br>
                <button type="submit">Удалить объект</button>
            </form>
        </section>
    </main>

    <script>
        // Модель данных для объектов
        class PropertyModel {
            constructor() {
                this.key = 'properties';
                this.properties = [];
                this.restore();
            }

            // Восстановление данных из localStorage
            restore() {
                const storedData = localStorage.getItem(this.key);
                if (storedData) {
                    this.properties = JSON.parse(storedData);
                } else {
                    this.properties = [
                        { id: '1', description: 'Описание объекта 1', createdAt: new Date('2024-01-01'), author: 'Иван Иванов', photoLink: 'https://example.com/photo1.jpg' },
                        { id: '2', description: 'Описание объекта 2', createdAt: new Date('2024-01-02'), author: 'Петр Петров', photoLink: 'https://example.com/photo2.jpg' },
                        { id: '3', description: 'Описание объекта 3', createdAt: new Date('2024-01-03'), author: 'Анна Смирнова' }
                    ];
                    this.save();
                }
            }

            // Сохранение данных в localStorage
            save() {
                localStorage.setItem(this.key, JSON.stringify(this.properties));
            }

            getNextId() {
                return this.properties.length ? Math.max(...this.properties.map(p => parseInt(p.id))) + 1 : 1;
            }

            add(property) {
                this.properties.push(property);
                this.save();
            }

            update(id, updates) {
                const prop = this.properties.find(p => p.id === id);
                if (prop) {
                    Object.assign(prop, updates);
                    this.save();
                    return true;
                }
                return false;
            }

            delete(id) {
                const index = this.properties.findIndex(p => p.id === id);
                if (index !== -1) {
                    this.properties.splice(index, 1);
                    this.save();
                    return true;
                }
                return false;
            }

            search(query) {
                const term = query.toLowerCase();
                return this.properties.filter(p =>
                    p.description.toLowerCase().includes(term) ||
                    p.author.toLowerCase().includes(term) ||
                    p.createdAt.toString().includes(term)
                );
            }
        }

        // View (представление)
        class PropertyView {
            static toggleSection(sectionId) {
                document.querySelectorAll('main > section').forEach(section => {
                    section.style.display = section.id === sectionId ? 'block' : 'none';
                });
            }

            static renderSearchResults(results) {
                const container = document.getElementById('search-results');
                container.innerHTML = results.length
                    ? results.map(r => `
                        <p>
                            <strong>ID:</strong> ${r.id}, 
                            <strong>Описание:</strong> ${r.description}, 
                            <strong>Дата:</strong> ${r.createdAt.toLocaleDateString()}, 
                            <strong>Автор:</strong> ${r.author}, 
                            ${r.photoLink ? `<img src="${r.photoLink}" alt="Фото" width="100">` : ''}
                        </p>`).join('')
                    : '<p>Результатов не найдено.</p>';
            }

            static resetForm(formId) {
                document.getElementById(formId).reset();
            }

            static showMessage(message) {
                alert(message);
            }

            static showLoginForm() {
                document.getElementById('login-form').style.display = 'block';
            }

            static hideLoginForm() {
                document.getElementById('login-form').style.display = 'none';
            }
        }

        // Контроллер
        class PropertyController {
            constructor() {
                this.model = new PropertyModel();
                this.init();
            }

            init() {
                this.bindNavigation();
                this.bindLoginForm();
                this.bindAddForm();
                this.bindEditForm();
                this.bindDeleteForm();
                this.bindSearchForm();
                this.checkAuth();
            }

            checkAuth() {
                const loggedInUser = localStorage.getItem('loggedInUser');
                if (loggedInUser) {
                    this.user = JSON.parse(loggedInUser);
                    PropertyView.hideLoginForm();
                    this.setupRolePermissions();
                } else {
                    PropertyView.showLoginForm();
                }
            }

            setupRolePermissions() {
                if (this.user.role === 'admin') {
                    document.getElementById('admin-section').style.display = 'block';
                    document.getElementById('user-section').style.display = 'none';
                } else {
                    document.getElementById('admin-section').style.display = 'none';
                    document.getElementById('user-section').style.display = 'block';
                }
            }

            bindNavigation() {
                const navLinks = document.querySelectorAll('header nav ul li a');
                navLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const target = link.getAttribute('href').substring(1);
                        PropertyView.toggleSection(target);
                    });
                });
            }

            bindLoginForm() {
                document.getElementById('login-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const username = document.getElementById('username').value;
                    const password = document.getElementById('password').value;
                    
                    // Пример проверки данных пользователя
                    if (username === 'admin' && password === 'admin123') {
                        this.user = { username, role: 'admin' };
                    } else if (username === 'user' && password === 'user123') {
                        this.user = { username, role: 'user' };
                    } else {
                        PropertyView.showMessage('Неверный логин или пароль');
                        return;
                    }

                    localStorage.setItem('loggedInUser', JSON.stringify(this.user));
                    PropertyView.hideLoginForm();
                    this.setupRolePermissions();
                });
            }

            bindAddForm() {
                document.getElementById('add-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const description = document.getElementById('description').value;
                    const author = document.getElementById('author').value;
                    const photoLink = document.getElementById('photoLink').value || undefined;

                    this.model.add({ id: this.model.getNextId(), description, createdAt: new Date(), author, photoLink });
                    PropertyView.showMessage('Объект добавлен успешно!');
                    PropertyView.resetForm('add-form');
                });
            }

            bindEditForm() {
                document.getElementById('edit-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const id = parseInt(document.getElementById('edit-id').value);
                    const updates = {
                        description: document.getElementById('new-description').value || undefined,
                        author: document.getElementById('new-author').value || undefined,
                        photoLink: document.getElementById('new-photoLink').value || undefined,
                    };

                    if (this.model.update(id, updates)) {
                        PropertyView.showMessage('Информация обновлена успешно!');
                        PropertyView.resetForm('edit-form');
                    } else {
                        PropertyView.showMessage('Объект с таким ID не найден!');
                    }
                });
            }

            bindDeleteForm() {
                document.getElementById('delete-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const id = parseInt(document.getElementById('delete-id').value);

                    if (this.model.delete(id)) {
                        PropertyView.showMessage('Объект удален успешно!');
                        PropertyView.resetForm('delete-form');
                    } else {
                        PropertyView.showMessage('Объект с таким ID не найден!');
                    }
                });
            }

            bindSearchForm() {
                document.getElementById('search-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const query = document.getElementById('search-query').value;
                    const results = this.model.search(query);
                    PropertyView.renderSearchResults(results);
                });
            }
        }

        // Инициализация контроллера при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            new PropertyController();
        });
    </script>
</body>
</html>
